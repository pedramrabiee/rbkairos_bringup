# RB-Kairos+ Controllers Configuration
# Author: Pedram Rabiee (prabiee@3laws.io)

controller_manager:
  ros__parameters:
    update_rate: 100  # Hz

    # Joint state controller (always needed)
    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    # Mobile base controller (omnidirectional)
    robotnik_base_control:
      type: omnidirectional_controller/OmnidirectionalController

    # Arm controller (UR5e)
    joint_trajectory_controller:
      type: joint_trajectory_controller/JointTrajectoryController

    # Gripper controller (Robotiq)
    gripper_controller:
      type: position_controllers/GripperActionController

# Joint State Broadcaster
joint_state_broadcaster:
  ros__parameters:
    joints:
      # UR5e arm joints
      - robot_arm_shoulder_pan_joint
      - robot_arm_shoulder_lift_joint
      - robot_arm_elbow_joint
      - robot_arm_wrist_1_joint
      - robot_arm_wrist_2_joint
      - robot_arm_wrist_3_joint
      # Gripper joints
      - robot_gripper_finger_joint

# Base Controller Configuration
robotnik_base_control:
  ros__parameters:
    # Control mode
    control_mode: "velocity"  # velocity, position

    # Command topic
    cmd_vel_topic: "cmd_vel"

    # Odometry configuration
    publish_odom: true
    odom_frame: "odom"
    base_frame: "base_link"

    # Wheel configuration
    wheel_names:
      - "robot_front_right_wheel_joint"
      - "robot_front_left_wheel_joint"
      - "robot_rear_right_wheel_joint"
      - "robot_rear_left_wheel_joint"

    # Kinematic parameters
    wheel_radius: 0.1  # meters
    wheel_base: 0.88   # meters
    track_width: 0.6   # meters

    # Velocity limits
    linear_x_max_velocity: 1.0     # m/s
    linear_y_max_velocity: 1.0     # m/s (omnidirectional)
    angular_z_max_velocity: 1.5    # rad/s

    # Acceleration limits
    linear_acceleration_limit: 0.5   # m/s^2
    angular_acceleration_limit: 1.0  # rad/s^2

# Arm Controller Configuration
joint_trajectory_controller:
  ros__parameters:
    joints:
      - robot_arm_shoulder_pan_joint
      - robot_arm_shoulder_lift_joint
      - robot_arm_elbow_joint
      - robot_arm_wrist_1_joint
      - robot_arm_wrist_2_joint
      - robot_arm_wrist_3_joint

    # Command interfaces
    command_interfaces:
      - position
      - velocity

    # State interfaces
    state_interfaces:
      - position
      - velocity

    # Tolerances
    goal_time: 0.5
    stopped_velocity_tolerance: 0.01

    # Constraints
    constraints:
      stopped_velocity_tolerance: 0.01
      goal_time: 0.5
      robot_arm_shoulder_pan_joint:
        trajectory: 0.05
        goal: 0.03
      robot_arm_shoulder_lift_joint:
        trajectory: 0.05
        goal: 0.03
      robot_arm_elbow_joint:
        trajectory: 0.05
        goal: 0.03
      robot_arm_wrist_1_joint:
        trajectory: 0.05
        goal: 0.03
      robot_arm_wrist_2_joint:
        trajectory: 0.05
        goal: 0.03
      robot_arm_wrist_3_joint:
        trajectory: 0.05
        goal: 0.03

# Gripper Controller Configuration
gripper_controller:
  ros__parameters:
    joint: robot_gripper_finger_joint

    # Action server name
    action_monitor_rate: 20.0

    # Goal tolerance
    goal_tolerance: 0.01

    # Max effort
    max_effort: 100.0

    # Stall detection
    stall_velocity_threshold: 0.001
    stall_timeout: 1.0